<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">
	<select id="getNotice" parameterType="list" resultType="noticeDto">
		SELECT
			  seq
			, title
			, input_date
		FROM notice
		ORDER BY input_date desc
	</select>

	<insert id="inputNotice" parameterType="noticeDto">
		INSERT INTO notice (
			  seq
			, user_no
			, title
			, content
			, input_date
		) VALUES(
			  (SELECT IFNULL(MAX(n.seq),0) + 1 FROM notice n)
			, #{title}
			, #{content}
			, #{input_date}
	</insert>

	<update id="modifyNotice" parameterType="noticeDto">
		UPDATE notice
		SET
			  title = #{title}
			, content = #{content}
			, upd_date = #{upd_date}
		WHERE seq = #{seq}
	</update>

	<delete id="deleteNotice" parameterType="int">
		DELETE
		FROM notice
		WHERE seq = #{seq}
	</delete>
	
	<select id="getQna" parameterType="list" resultType="QnaDto">
		SELECT
			  seq
			, title
			, input_date
			, status
		FROM qna
		ORDER BY seq DESC
	</select>
	
	<select id="selectQna" parameterType="Integer" resultType="hashmap">
		SELECT
			title
		  , content
		FROM qna
		WHERE seq = #{seq}
	</select>

	<insert id="inputQnaReply" parameterType="qnaDto">
		INSERT INTO QNA (
			Q_RE_NO
			, Q_RE_TITLE
			, Q_RE_CONTENT
			, Q_RE_DATE
		) VALUES(
			(SELECT IFNULL(MAX(Q.Q_NO),0) + 1 FROM QNA Q)
			, #{q_re_title}
			, #{q_re_content}
			, NOW())
	</insert>

	<update id="modifyQnaReply" parameterType="qnaDto">
		UPDATE QNA
		SET
			  Q_RE_TITLE = #{q_re_title}
			, Q_RE_CONTENT = #{q_re_content}
			, Q_RE_UPD_DATE = #{q_re_upd_date}
		WHERE Q_RE_NO = #{q_re_no}
	</update>

	<delete id="deleteQnaReply" parameterType="int">
		DELETE
		FROM QNA
		WHERE Q_RE_NO = #{q_re_no}
	</delete>

	<select id="faq" parameterType="list" resultType="faqDto">
		SELECT
			  FAQ_NO
			, FAQ_CATEGORY
			, FAQ_TITLE
			, FAQ_DATE
			, FAQ_COUNT
		FROM FAQ
		ORDER BY FAQ_NO DESC
	</select>

	<select id="faqDetail" parameterType="String" resultType="faqDto">
		SELECT
			FAQ_NO
			, FAQ_TITLE
			, FAQ_CONTENT
			, FAQ_DATE
			, FAQ_CATEGORY
			, FAQ_COUNT
		FROM FAQ
		WHERE FAQ_NO = #{faq_no}
	</select>

	<insert id="inputFaq" parameterType="faqDto" keyProperty="faq_no">
		INSERT INTO FAQ (
			  FAQ_NO
			, FAQ_TITLE
			, FAQ_CONTENT
			, FAQ_DATE
			, FAQ_CATEGORY
		) VALUES(
			(SELECT IFNULL(MAX(F.FAQ_NO),0) + 1 FROM FAQ F)
			, #{faq_title}
			, #{faq_content}
			, NOW()
			, #{faq_category})
	</insert>

	<update id="modifyFaq" parameterType="faqDto">
		UPDATE FAQ
		SET 
 			  FAQ_TITLE = #{faq_title}
			, FAQ_CONTENT = #{faq_content}
			, FAQ_UPD_DATE = NOW()
			, FAQ_CATEGORY = #{faq_category}
		WHERE FAQ_NO = #{faq_no}
	</update>

	<delete id="deleteFaq" parameterType="int">
		DELETE
		FROM FAQ
		WHERE FAQ_NO = #{faq_no}
	</delete>

	<select id="hashTagSearch" parameterType="string" resultType="faqDto">
		SELECT
			FAQ_NO
			, FAQ_CATEGORY
			, FAQ_TITLE
			, FAQ_DATE
			FROM FAQ
		WHERE FAQ_CATEGORY = #{faq_category}
	</select>

	<select id="courseList" parameterType="pageDto" resultType="courseDto">
		<![CDATA[
			SELECT 
				  @rownum:=@rownum +1 as rnum
				, seq
				, title
				, APP_PERSONNEL
				, ent_personnel
				, DATE_FORMAT(input_date, '%Y-%m-%d') as input_date
				, DATE_FORMAT(start_date, '%Y-%m-%d') as start_date
				, DATE_FORMAT(expire_date, '%Y-%m-%d') as expire_date
			FROM course C, (SELECT @rownum:=0) R
			WHERE title LIKE CONCAT('%', #{keyword}, '%')
			ORDER BY rnum desc
			LIMIT ${cri.pageStart}, ${cri.amount}
		]]>
	</select>

	<select id="getTotalCount" parameterType="String" resultType="int">
		SELECT
			COUNT(*) as TOTAL_COUNT
		FROM course
		WHERE title LIKE CONCAT('%', #{value}, '%')
	</select>

	<select id="courseDetail" parameterType="hashMap" resultType="courseDto">
		SELECT
			  seq
			, title
			, category
			, type
			, start_time
			, class_hour
			, DATE_FORMAT(start_date, '%Y-%m-%d') as start_date
			, DATE_FORMAT(expire_date, '%Y-%m-%d') as expire_date
			, ent_personnel
			, DATE_FORMAT(start_date, '%Y-%m-%d') as start_date
			, DATE_FORMAT(expire_date, '%Y-%m-%d') as expire_date
			, DATE_FORMAT(input_date, '%Y-%m-%d') as input_date
			, detail
			, tuition
		FROM course
		WHERE seq = #{seq}
	</select>

	<insert id="inputCourse" parameterType="courseDto">
		INSERT INTO course (
			  seq
			, user_no
			, title
			, category
			, type
			, class_hour
			, detail
			, ent_personnel
			, APP_PERSONNEL
			, input_date
			, start_date
			, expire_date
			, start_time
			, start_date
			, expire_date
		) VALUES (
			  (SELECT IFNULL(MAX(seq),0) + 1 FROM course)
			, #{user_no}
			, #{title}
			, #{category}
			, #{type}
			, #{class_hour}
			, #{detail}
			, #{ent_personnel}
			, #{app_personnel}
			, NOW()
			, #{start_date}
			, #{expire_date}
			, #{start_time}
			, #{start_date}
			, #{expire_date}
		)
	</insert>

	<update id="modifyCourse" parameterType="courseDto">
		UPDATE course
		SET
			  title = #{title}
			, category = #{category}
			, type = #{type}
			, class_hour = #{class_hour}
			, start_time = #{start_time}
			, ent_personnel = #{ent_personnel}
			, start_date = #{start_date}
			, expire_date = #{expire_date}
			, start_date = #{start_date}
			, expire_date = #{expire_date}
			, detail = #{detail}
			, upd_date = NOW()
			, tuition = #{tuition}
		WHERE seq = #{seq}
	</update>

	<delete id="deleteCourse" parameterType="int">
		DELETE
		FROM course
		WHERE seq = #{seq}
	</delete>

	<select id="appList" parameterType="pageDto" resultType="hashmap">
	<![CDATA[
		SELECT
			  @rownum:=@rownum +1 as rnum
			, c.title
			, m.user_no
			, m.user_name
			, DATE_FORMAT(input_date, '%Y-%m-%d') as input_date
			, DATE_FORMAT(start_date, '%Y-%m-%d') as start_date
			, DATE_FORMAT(expire_date, '%Y-%m-%d') as expire_date
		FROM APPLICATION a, course c, MEMBER m, (SELECT @rownum:=0) R
		WHERE a.user_no = m.user_no  
		  AND c.seq = a.seq 
		  AND title LIKE CONCAT('%', #{keyword}, '%')
		ORDER BY rnum DESC
		LIMIT ${cri.pageStart}, ${cri.amount}
	]]>
	</select>

	<select id="getAppTotal" parameterType="pageDto" resultType="int">
		SELECT
			COUNT(a.seq) as TOTAL_COUNT
		FROM application a
		  LEFT JOIN course c ON a.seq = c.seq
		WHERE c.title LIKE CONCAT('%', #{keyword}, '%')
	</select>

	<select id="appDetail" parameterType="hashMap" resultType="appDto">
		SELECT
			c.seq
			, a.seq
			, c.title
			, c.category
			, c.type
			, c.start_time
			, c.class_hour
			, DATE_FORMAT(start_date, '%Y-%m-%d') as start_date
			, DATE_FORMAT(expire_date, '%Y-%m-%d') as expire_date
			, m.user_no
			, m.user_name
			, m.email
			, m.phone
			, m.address
			, DATE_FORMAT(a.input_date, '%Y-%m-%d') as input_date
			, c.tuition
		FROM application a
		  LEFT JOIN course c ON a.seq = c.seq
		  LEFT JOIN member m ON c.user_no = m.user_no
		WHERE a.input_date = #{input_date}
	</select>
</mapper>
	 